let paso=1;document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));const cita={id:"",nombre:"",hora:"",fecha:"",servicios:[]};function iniciarApp(){tabs(),consultarApi(),cita.nombre=document.querySelector("#nombre").value,cita.id=document.querySelector("#id").value,seleccionarFecha(),seleccionarHora(),mostrarResumenCita()}function tabs(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",(function(e){paso=parseInt(e.target.dataset.paso),mostrarSeccion(),3===paso&&mostrarResumenCita()}))})}function mostrarSeccion(){document.querySelector(".actual").classList.remove("actual");const e=`button[data-paso='${paso}']`;document.querySelector(e).classList.add("actual"),document.querySelector(".mostrar").classList.remove("mostrar");const t=`div[id='paso-${paso}']`;document.querySelector(t).classList.add("mostrar")}function paginador(){if(1===paso){document.querySelector("#anterior").style.visibility="hidden";document.querySelector("#siguiente").addEventListener("click",(function(){paso++,mostrarSeccion()}))}if(3===paso){document.querySelector("#siguiente").style.visibility="hidden";document.querySelector("#anterior").addEventListener("click",(function(){paso--,mostrarSeccion()}))}2===paso&&(document.querySelector("#anterior").style.visibility="visible",document.querySelector("#siguiente").style.visibility="visible")}async function consultarApi(){try{const e="http://localhost:9090/api/servicios",t=await fetch(e);mostrarServicios(await t.json())}catch(e){console.error(e)}}function mostrarServicios(e){e.forEach(e=>{const{id:t,nombre:o,precio:n}=e,a=document.createElement("P");a.textContent=o,a.classList.add("nombre-servicio");const r=document.createElement("P");r.textContent="$ "+n,r.classList.add("precio-servicio");const c=document.createElement("DIV");c.classList.add("servicio"),c.dataset.servicio=t,c.onclick=function(){seleccionarServicio(e)},c.appendChild(a),c.appendChild(r),document.querySelector("#servicios").appendChild(c)})}function seleccionarServicio(e){const{servicios:t}=cita,{id:o}=e;t.some(e=>e.id===o)?(cita.servicios=t.filter(e=>o!==e.id),document.querySelector(`div[data-servicio='${o}']`).classList.remove("selected")):(cita.servicios=[...t,e],document.querySelector(`div[data-servicio='${o}']`).classList.add("selected"))}function seleccionarFecha(){document.querySelector("#fecha").addEventListener("input",(function(e){const t=e.target.value,o=new Date(e.target.value).getUTCDay();[6,0].includes(o)?(e.target.value="",mostrarAlerta("Sabados y Domingos no atendemos","error",".formulario",!0)):cita.fecha=t}))}function seleccionarHora(){document.querySelector("#hora").addEventListener("input",(function(e){const t=e.target.value,o=t.split(":")[0];o<8||o>18?mostrarAlerta("Horas no validas","error",".formulario",!0):cita.hora=t}))}function mostrarAlerta(e,t,o,n){const a=document.createElement("DIV");a.textContent=e,a.classList.add("alerta",t),document.querySelector(".alerta")&&document.querySelector(".alerta").remove();const r=document.querySelector(o);r.appendChild(a),n&&setTimeout(()=>{r.removeChild(a)},3e3)}function mostrarResumenCita(){const e=document.querySelector(".resumen");for(;e.firstChild;)e.removeChild(e.firstChild);const t=document.createElement("H3");if(t.textContent="Resumen de Cita",e.appendChild(t),Object.values(cita).includes("")||0===cita.servicios.length)return void(0===cita.servicios.length?mostrarAlerta("No ha seleccionado un servicio",".error",".resumen",!1):mostrarAlerta("Faltan datos de llenar",".error",".resumen",!1));const{nombre:o,fecha:n,hora:a,servicios:r}=cita,c=document.createElement("P");c.innerHTML="<span>Nombre: </span>"+o;const i=document.createElement("P");i.innerHTML="<span>Fecha: </span>"+n;const s=document.createElement("P");s.innerHTML="<span>Hora: </span>"+a,e.appendChild(c),e.appendChild(i),e.appendChild(s);const d=document.createElement("H3");d.textContent="Resumen de Servicios",e.appendChild(d),r.forEach(t=>{const{id:o,nombre:n,precio:a}=t,r=document.createElement("DIV");r.classList.add("contenedor-servicio");const c=document.createElement("P");c.textContent=n;const i=document.createElement("P");i.innerHTML="<span>Precio: </span>$"+a,r.appendChild(c),r.appendChild(i),e.appendChild(r)});const l=document.createElement("BUTTON");l.textContent="Reservar cita",l.classList.add("boton"),l.onclick=reservarCita,e.appendChild(l)}async function reservarCita(){const{id:e,fecha:t,hora:o,servicios:n}=cita,a=n.map(e=>e.id),r=new FormData;r.append("usuarioId",e),r.append("fecha",t),r.append("hora",o),r.append("servicios",a);try{const e="http://localhost:9090/api/guardar",t=await fetch(e,{method:"POST",body:r});(await t.json()).resultado&&Swal.fire({icon:"success",title:"Cita creada",text:"Tu cita fue creada correctamente",button:"Ok"}).then(()=>{window.location.reload()})}catch(e){Swal.fire({icon:"error",title:"Error",text:"Ha ocurrido un error",button:"Ok"}).then(()=>{window.location.reload()})}}